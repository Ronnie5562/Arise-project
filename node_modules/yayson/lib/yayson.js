var Adapter, Q, _, adapters, lookupAdapter, presenter, presenterFactory, utils;

if (typeof window !== "undefined" && window !== null) {
  Q = window.Q;
  _ = window._;
}

Q || (Q = ((function() {
  try {
    return typeof require === "function" ? require('q') : void 0;
  } catch (error) {}
})()));

_ || (_ = ((function() {
  try {
    return typeof require === "function" ? require('lodash') : void 0;
  } catch (error) {}
})()));

_ || (_ = ((function() {
  try {
    return typeof require === "function" ? require('underscore') : void 0;
  } catch (error) {}
})()));

utils = require('./yayson/utils')(_, Q);

Adapter = require('./yayson/adapter');

adapters = require('./yayson/adapters');

presenterFactory = require('./yayson/presenter');

lookupAdapter = function(nameOrAdapter) {
  if (nameOrAdapter === 'default') {
    return Adapter;
  }
  return adapters[nameOrAdapter] || nameOrAdapter || Adapter;
};

presenter = function(options = {}) {
  var adapter;
  adapter = lookupAdapter(options.adapter);
  return presenterFactory(utils, adapter);
};

module.exports = function({adapter} = {}) {
  return {
    Store: require('./yayson/store')(utils),
    Presenter: presenter({adapter}),
    Adapter: Adapter
  };
};
